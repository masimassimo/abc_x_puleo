<odoo>
    
    <!-- Template del report PDF della fattura immediata/differita di Puleo. -->
    
    <template id="fattura_imm_e_diff_template_puleo">
        <t t-call="web.basic_layout">
            <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)"/>

     <style type="text/css">
       
                    .small-font {
                                    font-size:80%;
                                }
                    .smaller-font {
                                    font-size:50%;
                                }
                    .bold-font {
                                    font-weight:bold
                                    }
                    .rounded-tl {
                                    border-top-left-radius: 5px
                                }
                    .rounded-tr {
                                    border-top-right-radius: 5px
                                }
                    .rounded-bl {
                                    border-bottom-left-radius: 5px;
                                }
                    .rounded-br {
                                    border-bottom-right-radius: 5px
                    
                    .full-width {   
                                    width:100%
                                    margin-left:auto;
                                    margin-right:auto;
                                }

            </style>
                <!-- Div che contiene le INFO dell'Azienda e del Cliente -->
         
                <div t-attf-class="header o_company_#{o.company_id.id}_layout" t-att-style="report_header_style">
                <div class="row address mb-1 small-font">
                
                    <div class="col-5">
                        <t t-if="image_data_uri(o.team_id.x_avatar_image)">
                        <div>
                            <img class="img-fluid" t-att-src="image_data_uri(o.team_id.x_avatar_image)" style="max-width:250px"/>
                        </div>
                        </t>
                        <t t-else="">
                            <div>
                                <img class="img-fluid" t-att-src="image_data_uri(o.company_id.logo)" style="max-width:250px"/>
                            </div>
                        </t>
                    </div>
                    

                    <div class="col-3" style="text-align:right;">
                        <div style="font-weight: bold; font-size:100%;" t-field="o.company_id.partner_id"/>
                        <div>
                            <ul class="list-inline" style="font-size:80%;">
                                <li t-if="o.company_id.city and o.company_id.zip and o.company_id.state_id and o.company_id.country_id"> <span t-field="o.company_id.zip"/> <span t-field="o.company_id.city"/> <span t-field="o.company_id.state_id.code"/> / <span style="color:red; text-transform: uppercase;" t-field="o.company_id.country_id"/>  </li>
                                <li t-if="o.company_id.street"> <span t-field="o.company_id.street"/> </li>
                                <li t-if="o.company_id.street2"> <span t-field="o.company_id.street2"/> </li>
                                <li t-if="o.company_id.phone"> Tel <span t-field="o.company_id.phone"/> </li>
                                <li> Fax <span> +39 0923968920 </span> </li>

                            </ul>
                        </div>
                    </div>
                  
                    
                    <div class="col-4">
                        <div class="border-left">
                        <ul class="ml-1 list-inline" style="font-size:80%;">
                            <li> <span>P.IVA/C.F./REG.I. 01233360815</span> </li>
                            <li> <span>Cap. Soc. Int. vers. € 1.500.000.00</span> </li>
                            <li t-if="o.company_id.website"> <span t-field="o.company_id.website"/> </li>
                            <li t-if="o.company_id.email"> <span t-field="o.company_id.email"/> </li>
                            <li> <span>service@puleoitalia.com</span> </li>
                            <li> <span>puleospa@legalmail.it</span> </li>
                        </ul>
                        </div>
                    </div>
                    </div>
                </div>

    <div class="row address mb-3 small-font">
    <div class="col-6">
          <table class="table table-bordered">
              <thead>
                  <tr scope="row">
                    <th scope="col" class="p-1 align-top text-left small-font col-6" style="width:50%">
                        <span>Documento</span>
                    </th>
                    <th scope="col" class="p-1 align-top text-center small-font col-2" style="width:16.66%">
                        <span>Numero</span>
                    </th>
                    <th scope="col" class="p-1 align-top text-center small-font col-2" style="width:16.66%">
                        <span>Data</span>
                    </th>
                    <th scope="col" class="p-1 align-top text-center small-font col-2" style="width:16.66%">
                        <span>Pagina</span>
                    </th>
                    </tr>
                </thead>
                <tbody>
                    <tr scope="row">
                        <td class="p-1 align-top text-left small-font col-6" style="width:50%">
                            <t t-if="not (env.context.get('proforma', False) or is_pro_forma)">
                                <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">Fattura</span>
                                <span t-if="o.move_type == 'out_invoice' and o.state == 'draft'">Bozza Fattura</span>
                                <span t-if="o.move_type == 'out_invoice' and o.state == 'cancel'">Fattura Annullata</span>
                                <span t-if="o.move_type == 'out_refund'">Nota di Credito</span>
                                <span t-if="o.move_type == 'in_refund'">Nota di Credito Fornitore</span>
                                <span t-if="o.move_type == 'in_invoice'">Fattura di Acquisto</span>
                                <span t-if="o.name != '/'" t-field="o.name"/>
                            </t>
                            <t style="font-weight:bold;" t-if="env.context.get('proforma', False) or is_pro_forma">
                                <span>Fattura Pro-forma</span>
                            </t>
                        </td>
                        <td class="p-1 align-middle text-center small-font col-2" style="width:16.66%">
                            <span t-field="o.name"/>
                        </td>
                        <td class="p-1 align-middle text-center small-font col-2" style="width:16.66%">
                            <span t-if="o.invoice_date" t-field="o.invoice_date"/> 
                        </td>
                        <td class="p-1 align-middle text-center small-font col-2" style="width:16.66%">
                           <!-- Page -->
                           
                           


                        </td>
                    </tr>
                </tbody>
                <thead>
                    <tr scope="row">
                        <th scope="col" colspan="2" class="p-1 align-top text-left small-font col-6" style="width:50%">
                            <span>Partita IVA</span>
                        </th>
                        <th scope="col" colspan="2" class="p-1 align-top text-left small-font col-6" style="width:50%">
                            <span>Codice Fiscale</span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <td colspan="2" class="p-1 align-middle text-left small-font col-6" style="width:50%">
                        <span t-field="o.partner_id.vat"/>
                    </td>
                      <td colspan="2" class="p-1 align-middle text-left small-font col-6" style="width:50%">
                        <span t-field="o.partner_id.fiscalcode"/>
                    </td>
                </tbody>
                <thead>
                     <tr scope="row">
                        <th scope="col" class="p-1 align-top text-left small-font col-1" style="width:10%">
                            <span>Agente</span>
                        </th>
                        <th scope="col" class="p-1 align-top text-left small-font col-3" style="width:30%">
                            <span>Tipo Container</span>
                        </th>
                         <th scope="col" class="p-1 align-top text-left small-font col3" style="width:30%">
                            <span>N° Container</span>
                        </th>
                        <th scope="col" class="p-1 align-top text-left smaller-font col-3" style="width:30%">
                            <span>N° Sigillo</span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <td colspan="1" class="p-1 align-middle text-left small-font col-6" style="width:10%">
                        <span t-field="o.invoice_user_id"/>
                    </td>
                     <td colspan="1" class="p-1 align-middle text-left small-font col-6" style="width:30%">
                        <span t-if="o.delivery_note_ids" t-esc="o.delivery_note_ids[0].tipo_container"/>
                    </td>
                       <td colspan="1" class="p-1 align-middle text-left small-font col-6" style="width:30%">
                                     <span t-if="o.delivery_note_ids" t-esc="o.delivery_note_ids[0].n_container"/>
                    </td>
                      <td colspan="1" class="p-1 align-middle text-left small-font col-6" style="width:30%">
              <span t-if="o.delivery_note_ids" t-esc="o.delivery_note_ids[0].n_sigillo"/>
                    </td>
                    
                </tbody>
                
                <thead>
                     <tr scope="row">
                        <th scope="col" colspan="2" class="p-1 align-top text-left small-font col-9" style="width:66.66%">
                            <span>Pagamento</span>
                        </th>
                        <th scope="col" colspan="2" class="p-1 align-top text-left small-font col-3" style="width:33.33%">
                            <span>Rif. Ordine Cliente</span>
                        </th>
      
                    </tr>
                </thead>
                
                <tbody>
                    <td colspan="2" class="p-1 align-middle text-left small-font col-9" style="width:66.66%">
                                <t t-if="o.invoice_payment_term_id">
                                     <span t-field="o.invoice_payment_term_id.name"/>
                                </t>
                                <t t-else="">
                                    <span t-field="o.invoice_date_due" options="{&quot;widget&quot;: &quot;date&quot;}"/>
                                </t>
                                                
                    </td>
                     <td colspan="2" class="p-1 align-middle text-left small-font col-3" style="width:33.33%">
                        <span t-field="o.invoice_origin"/> - <t t-if="o.invoice_line_ids.sale_line_ids.order_id.date_order" t-esc="o.invoice_line_ids.sale_line_ids.order_id.date_order.strftime('%d/%m/%Y')"/>
                    </td>
                
                    
                </tbody>
                
                <thead>
                     <tr scope="row">
                        <th scope="col" colspan="4" class="p-1 align-top text-left small-font col-12" style="width:100%">
                            <span>Banca d'Appoggio </span>
                        </th>
                 
      
                    </tr>
                </thead>
                <tbody>
                      <td colspan="4" class="p-1 align-middle text-left small-font col-12" style="width:100%;">
                        <t t-if="o.invoice_line_ids.sale_line_ids.order_id.banca_cliente">
                       <span t-esc="o.invoice_line_ids.sale_line_ids.order_id.banca_cliente.bank_id.name"/>
                       <div>
                       IBAN: <span t-esc="o.invoice_line_ids.sale_line_ids.order_id.banca_cliente.acc_number"></span>
                       BIC: <span t-esc="o.invoice_line_ids.sale_line_ids.order_id.banca_cliente.bank_id.bic"></span>
                       </div>
                          </t>
                          <t t-else="">
                              <br/>
                          </t>
                       
                    </td>
                
                </tbody>
                
                
                 <thead>
                     <tr scope="row">
                        <th scope="col" colspan="4" class="p-1 align-top text-left small-font col-12" style="width:100%">
                            <span>Banca </span>
                        </th>
                 
      
                    </tr>
                </thead>
                <tbody>
                      <td colspan="4" class="p-1 align-middle text-left small-font col-12" style="width:100%">
                         <t t-if="o.partner_bank_id.bank_id">
                        <div t-field="o.partner_bank_id.bank_id.name"/> 
                       
                        <div> 
                        IBAN: <span t-field="o.partner_bank_id.acc_number"/> 
                        BIC: <span class="text-right" t-field="o.partner_bank_id.bank_id.bic"/>
                        </div> 
                       </t>
                         <t t-else="">
                              <br/>
                          </t>
                       
                    </td>
                
                </tbody>
                
                
          </table>
    </div>
    
     <div class="col-6">
         <table class="table table-bordered">
             <thead>
                 
             
       
        </thead>
        <tbody>
            
               
       <td>
   
        
                    <span style="margin-bottom:0px;">Spett.le</span>
                    <div>
                        <span t-field="o.partner_id"/>
                    </div>
                    <span t-field="o.partner_id.street" style=""/>
                    <div style="">
                        <span t-field="o.partner_id.zip"/>
                        <span t-field="o.partner_id.city"/>
                        <span t-field="o.partner_id.state_id"/> 
                    </div>

                <div style="margin-top:10px;  line-height:100%">
                    <strong t-if="o.partner_shipping_id == o.partner_id" style="">Indirizzo di Fatturazione e Spedizione:</strong>
                    <strong t-if="o.partner_shipping_id != o.partner_id" style="">Indirizzo di Fatturazione:</strong>
                    <div style="" t-field="o.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: True}"/>
                    <t t-if="o.partner_shipping_id != o.partner_id">
                        <strong style="">Indirizzo di Spedizione:</strong>
                        <div style="" t-field="o.partner_shipping_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: True}"/>
                    </t>
               </div>
            </td>
         </tbody>
             
             
                      <thead>
             <tr scope="row">
            <th scope="col" class="p-1 align-top text-left small-font col-12" style="width:100%">
             Nominativo di riferimento 
             </th>
             </tr>
         </thead>
          <tbody>
            <tr scope="row">
             <td class="p-1 align-middle text-left small-font col-12" style="width:100%">
                 <t t-if="o.invoice_line_ids.sale_line_ids.order_id.nominativo_di_riferimento">
                 <span t-field="o.invoice_line_ids.sale_line_ids.order_id.nominativo_di_riferimento.name"/>
                 </t>
                 <t t-else="">
                     <br/>
                 </t>
                </td>
            </tr>
        </tbody>
             
             
    </table>
  
        
    
        
     </div>
     
    </div>  
    
<div class="page">
    

    <!-- Tabella Prodotti -->
    
    <table class="table table-bordered mt-1">
                <thead>
                        <tr scope="row">
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span>Codice</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-4" style="width:51.65%">
                                <span>Descrizione</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:4%">
                                <span>UM</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8%">
                                <span>Quantitò</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8%">
                                <span>Prezzo Un,</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:6%">
                                <span>Sconto %</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                <span>Importo</span>
                            </th>
                            <th scope="col" class="p-1 align-middle text-center smaller-font col-1" style="width:4%">
                                <span>IVA</span>
                            </th>
                        </tr> 
                         <tbody>
                        <t t-set="current_subtotal" t-value="0"/>
                        <t t-set="current_line" t-value="0"/>
                        <t t-set="totale_merce" t-value="0"/>
                        <t t-set="totale_netto" t-value="0"/>
                        <t t-set="totale_sconto" t-value="0"/>
                        <t t-set="down_payment" t-value="0"/>
                        <t t-set="numeroProdottiDDT" t-value="0"></t>
                     
                        <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                        <t t-foreach="lines" t-as="line">
                        
                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                            
                      
                 
                            <t t-if="not line.display_type">
                              
                                <t t-set="current_line" t-value="current_line + 1"/>
                                <tr scope="row">

                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                        <span t-field="line.product_id.default_code"/>
                                       
                                      
                                    </td>


                                    <td class="p-1 align-middle text-left smaller-font col-4" style="width:51.65%">
                                        
                                        <t t-if="'Acconto' == line.product_id.name">
                                            <t t-set="down_payment" t-value="1"/>
                                            <span t-field="line.name"/> -
                                                  <span> Rif. ns. Commessa cliente </span>
                                            <t t-esc="o.invoice_line_ids.sale_line_ids.order_id.name"/>
                                            <span> del </span>
                                            <t t-esc="o.invoice_line_ids.sale_line_ids.order_id.date_order.strftime('%d/%m/%Y')"/>
                                            <!-- span t-field="o.invoice_line_ids.sale_line_ids.order_id.payment_term_id" /-->

                                        </t>
                                        <t t-else="">
                                            <div t-if="o.invoice_line_ids.sale_line_ids.order_id.name and o.invoice_line_ids.sale_line_ids.order_id.date_order">
                                            <span> Rif. ns. Commessa cliente </span>
                                            <t t-esc="o.invoice_line_ids.sale_line_ids.order_id.name"/>
                                            <span> del </span>
                                            <t t-esc="o.invoice_line_ids.sale_line_ids.order_id.date_order.strftime('%d/%m/%Y')"/>
                                            </div>
                                            
                                            <!-- DDT -->
                                            <t t-if="numeroProdottiDDT != 0">
                                          
                                           
                                            <div>
                                                <t t-if="idDDT.sale_ids.warehouse_id.name == 'Magazzino Healthcare'">
                                                <span>Rif. ns. DdT div. Healthcare N. </span>
                                                </t>
                                                <t t-else="">
                                                <span>Rif. ns. DdT div. Puleo N. </span>
                                                </t>
                                                <t t-esc="numeroDDT"/> 
                                                
                                                <span> del </span>
                                                <t t-esc="dataDDT"/> 
                                            </div>
                                            
                                            <t t-set="numeroProdottiDDT" t-value="numeroProdottiDDT - 1"></t>
                                          
                                            </t>
                                            
                                           <t t-if="line.product_id and line.product_id.type != 'service' ">
                                            <!--strong t-field="line.product_id.name"/-->
                                             <strong t-raw="line.name"/>
                                            </t>
                                            <t t-else="">
                                                <strong t-raw="line.name"/> 
                                            </t>
                                            
                                            <t t-if="o.partner_id.country_id.id != 109 and line.product_id.codice_merce">
                                            -
                                                <span>Nomenclatura combinata: <t t-esc="line.product_id.codice_merce"/> </span>
                                            </t>
                                             <div>
                                                <t t-if="line.product_id.matricola">
                                                    Matricola: <span t-esc="line.product_id.matricola.name"/>
                                                </t>
                                            </div>
                                        </t>
                                    </td>

                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:4%">
                                        <span t-field="line.product_uom_id"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:8%">
                                        <span t-field="line.quantity"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:8%">
                                        <span t-field="line.price_unit"/>
                                        <t t-set="totale_merce" t-value="totale_merce + (line.price_unit*line.quantity)"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:6%">
                                        <span t-field="line.discount"/>
                                       <t t-set="totale_sconto" t-value="totale_sconto + (line.price_unit*line.quantity*line.discount/100)"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:8.33%">
                                        <span t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <t t-set="totale_netto" t-value="totale_netto + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <span t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                        <t t-set="totale_netto" t-value="totale_netto + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                    </td>
                                    <td class="p-1 align-middle text-center smaller-font col-1" style="width:4%">
                                        <t t-foreach="line.tax_ids" t-as="tax_line">
                                            <span t-field="tax_line.description"/>
                                        </t>
                                    </td>
                                </tr>   
                            </t>
                            <t t-else="">
                                <tr scope="row">
                                    <td colspan="10" class="p-1 align-middle text-left smaller-font col-12">
                                        <t t-set="numeroProdottiDDT" t-value="0"></t>
                                        <strong t-raw="line.name"/>
                                        <t t-if="line.delivery_note_id.id">
                                            <t t-set="idDDT" t-value= "line.delivery_note_id"></t>
                                            <t t-set="numeroDDT" t-value="line.delivery_note_id.name[4:]"></t>
                                            <t t-set="dataDDT" t-value="line.delivery_note_id.date.strftime('%d/%m/%Y')"></t>
                                        </t>
                                
                                        <t t-foreach="line.delivery_note_id.line_ids" t-as="righeDDT">
                                        
                                        <t t-if="righeDDT.product_id">
                                            <t t-set="numeroProdottiDDT" t-value="numeroProdottiDDT+1"></t>
                                        </t>
                                        </t>
                                     
                                        
                                       
                                        
                                        
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </tbody> 
                    </thead>
    </table>
    
     <table class="table table-bordered mt-1">
         <thead>
             <tr scope="row">
                 <th scope="col" class="p-1 align-middle text-center smaller-font col-6" style="width:50%">
                    <span>Note</span>
                </th>
                 <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:12.5%">
                    <span>Totale Articoli</span>
                </th>
                  <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:12.5%">
                    <span>Totale Solo IVA</span>
                </th>
                  <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:12.5%">
                    <span>Totale Omaggi</span>
                </th>
                  <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:12.5%">
                    <span>Totale Sconto Merce</span>
                </th>
            </tr>
         </thead>
        <tbody>
            <tr scope="row">
                  <td rowspan="3" class="p-1 align-middle text-left small-font col-6" style="width:50%">
                        <span t-field="o.narration"/>
                    </td>
                      <td class="p-1 align-middle text-right smaller-font col-2" style="width:12.5%">
                        <span t-esc="totale_merce" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </td>
                         <td class="p-1 align-middle text-right smaller-font col-2" style="width:12.5%">
                      
                      <!-- SOlo Iva -->
                     <t t-if="o.amount_sp&gt;0">
                          <span t-field="o.amount_tax"/>
                        
                         <span t-field="o.amount_sp" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                       </t>
                      <t t-else="">
                                
                                    <span t-field="o.amount_tax"/>
                              
                            </t>
                    
                    
                    
                    </td>
                         <td class="p-1 align-middle text-right small-font col-2" style="width:12.5%">
                        <!-- Totale Omaggi -->
                    </td>
                         <td class="p-1 align-middle text-right smaller-font col-2" style="width:12.5%">
                        <span t-esc="totale_sconto" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </td>
                </tr>
                <tr scope="row">
                      <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Totale Sc. Incondizionato</span>
                    </th>
                         <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Spese Bolli</span>
                    </th>
                         <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Spese Bancarie</span>
                    </th>
                             <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Spese Assicurazione</span>
                    </th>
                </tr>
                      <tr scope="row">
           
                      <td class="p-1 align-middle text-right small-font col-2" style="width:12.5%">
                        <!-- Totale Sc. Incondizionato -->
                        <br/>
                    </td>
                         <td class="p-1 align-middle text-right small-font col-2" style="width:12.5%">
                        <!-- Spese Bolli -->
                         <br/>
                    </td>
                         <td class="p-1 align-middle text-right small-font col-2" style="width:12.5%">
                        <!-- Spese Bancarie -->
                         <br/>
                    </td>
                         <td class="p-1 align-middle text-right small-font col-2" style="width:12.5%">
                        <!-- Spese Assicurazione -->
                         <br/>
                    </td>
                </tr>
            
        </tbody>
            <table class="table table-bordered mt-1">
            <thead>
             <tr scope="row">
                 <th scope="col" class="p-1 align-middle text-center smaller-font col-2 " style="width:16.66%">
                    <span>Scadenza</span>
                </th>
                   <th scope="col" class="p-1 align-middle text-center smaller-font col-2" style="width:16.66%">
                    <span>Importo</span>
                </th>
                   <th scope="col" class="p-1 align-middle text-center smaller-font col-2 " style="width:16.66%">
                    <span>Tipo Pagamento</span>
                </th>
                <th scope="col" class="p-1 align-middle text-center smaller-font  " style="width:12.5%">
                    <span>Spese Trasporto</span>
                </th>
                <th scope="col" class="p-1 align-middle text-center smaller-font  " style="width:12.5%">
                    <span>Spese Imballo</span>
                </th>
                <th scope="col" class="p-1 align-middle text-center smaller-font " style="width:12.5%">
                    <span>Spese Varie</span>
                </th>
                <th scope="col" class="p-1 align-middle text-center smaller-font  " style="width:12.5%">
                    <span>Sconto</span>
                </th>
   
            </tr>
         </thead>
         <tbody>
             <tr scope="row">
                 
                      <t t-set="termini" t-value="o.invoice_payment_term_id"/>
                      <t t-set="importo_pagamento" t-value="o.amount_total"/>
                     
                      
                      <td rowspan="5" class="p-1  text-left smaller-font col-2" style="width:16.66%">
                          
                           <t t-foreach="termini.line_ids" t-as="scadenza">
                                       
                              <t t-if="scadenza.day_of_the_month == 31">
                                <t t-set="mesi" t-value="int(scadenza.days/30)"/>
                               F.M
                                 <span t-if="o.invoice_date" t-esc="(datetime.datetime.strptime(str(o.invoice_date), '%Y-%m-%d') + relativedelta(months=mesi)).strftime('%m/%Y')"/>
                            
                            </t>
                               
                            <t t-if="scadenza.day_of_the_month==0 and scadenza.days==0">
                                    <span>Pagamento immediato</span>
                            </t>
                              <t t-if="scadenza.day_of_the_month != 31">
                             
                                   <!-- <span t-field="scadenza.days"/> -->
                                    <t t-set="giorni" t-value="scadenza.days"/>
                                    <span t-if="o.invoice_date" t-esc="(datetime.datetime.strptime(str(o.invoice_date), '%Y-%m-%d') + datetime.timedelta(days=giorni) ).strftime('%d/%m/%Y')"/>
                                  <!--  <span t-field="scadenza.option"/> -->
                            </t>
                    
                  
                            
                        <br/>          
                        
                        </t>
                             
                        
                    </td>
                         <td rowspan="5" class="p-1 text-center smaller-font col-2" style="width:16.66%">
                            <t t-foreach="termini.line_ids" t-as="scadenza">
                          
                            <t t-if="scadenza.value=='percent'">
                                <span t-esc="scadenza.value_amount*o.amount_total/100" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                            </t>
                            <t t-elif="scadenza.value=='fixed'"> 
                                <span t-esc="scadenza.value_amount" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                            </t>
                            <t t-else="">
                                <t t-esc="importo_pagamento" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                
                            </t>
                            
                            
                            <t t-if="scadenza.value=='percent'">
                                <t t-set="importo_pagamento" t-value="importo_pagamento-scadenza.value_amount*o.amount_total/100"/>
                            </t>
                            <t t-elif="scadenza.value=='fixed'">
                                <t t-set="importo_pagamento" t-value="importo_pagamento-scadenza.value_amount"/>
                            </t>
                            <t t-else=""> <t t-set="importo_pagamento" t-value="0"/>
                            
                            </t>
                            <br/>
                            
    
                            
                            </t>
                        
                        
                        
                        
                    </td>
                         <td rowspan="5" class="p-1  text-center smaller-font " style="width:16.66%">
                         <t t-foreach="termini.line_ids" t-as="scadenza">
                             <span t-esc="o.invoice_payment_term_id.name"/>
                                <br/>
                             </t>
                          
                    </td>
                         <td class="p-1 align-middle text-right small-font " style="width:12.5%">
                        <!-- Spese Trasporto -->
                         <br/>
                    </td>
                            <td class="p-1 align-middle text-right small-font " style="width:12.5%">
                         <!-- Spese Imballo -->
                          <br/>
                    </td>
                         <td class="p-1 align-middle text-right small-font " style="width:12.5%">
                        <!-- Spese Varie -->
                         <br/>
                    </td>
                         <td class="p-1 align-middle text-right small-font " style="width:12.5%">
                        <!-- Sconto -->
                         <br/>
                    </td>
                    
                </tr>
                        <tr scope="row">
                      <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Cod. IVA</span>
                    </th>
                         <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Imponibile</span>
                    </th>
                         <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Aliquota</span>
                    </th>
                             <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Imposte</span>
                    </th>
                </tr>
                <tr scope="row">
           
                      <td class="p-1  text-right smaller-font" style="width:12.5%">
                          <t t-value="[]" t-set="codiciIva"/>
                                <t t-value="[]" t-set="aliquoteIva"/>
                                <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                <t t-as="line" t-foreach="lines">
                                    <t t-if="line.tax_ids.description and (line.tax_ids.description not in codiciIva)">
                                        <t t-value="codiciIva.append(line.tax_ids.description)" t-set="codiciIvaDummy"/>
                                    </t>
                                </t>
                                <t t-as="cIva" t-foreach="codiciIva">
                                    <t t-esc="cIva"/><br/>
                                </t> 
                        
                    </td>
                         <td class="p-1  text-right smaller-font" style="width:12.5%">
                        
                        <!-- Imponibile -->
                        
                                  <t t-value="[]" t-set="imposta"/>
                                <t t-value="[]" t-set="codiciIva"/>
                                <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                <t t-as="line" t-foreach="lines">
                                    <t t-if="line.tax_ids.description and (line.tax_ids.description not in codiciIva)">
                                        <t t-value="codiciIva.append(line.tax_ids.description)" t-set="codiciIvaDummy"/>
                                    </t>
                                </t>
                                <t t-as="cIva" t-foreach="codiciIva">
                                    <t t-value="0" t-set="imponibile"/>
                                    <t t-value="0" t-set="imposta_temp"/>
                                    <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                    <t t-as="line" t-foreach="lines">
                                        <t t-if="line.tax_ids.description == cIva">
                                            <t t-value="imponibile + line.price_subtotal" t-set="imponibile"/>
                                            <t t-value="imponibile*(line.tax_ids.amount / 100) " t-set="imposta_temp"/>
                                        </t>
                                    </t>
                                    <t t-value="imposta.append(imposta_temp)" t-set="impostaDummy"/>
                                    <t t-esc="imponibile" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/><br/>
                                </t>
                        
                        
                    </td>
                         <td class="p-1  text-right smaller-font " style="width:12.5%">
                             <!-- Aliquota -->
                                   <t t-value="[]" t-set="codiciIva"/>
                                <t t-value="[]" t-set="aliquoteIva"/>
                                <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                <t t-as="line" t-foreach="lines">
                                    <t t-if="line.tax_ids.name and (line.tax_ids.name not in codiciIva)">
                                        <t t-value="codiciIva.append(line.tax_ids.name)" t-set="codiciIvaDummy"/>
                                    </t>
                                </t>
                                <t t-as="cIva" t-foreach="codiciIva">
                                    <t t-esc="cIva"/><br/>
                                </t> 
                    </td>
                         <td class="p-1 text-right smaller-font " style="width:12.5%">
                            
                            <!-- Imposte -->
                             <t t-as="impostaFor" t-foreach="imposta">
                                    <t t-esc="impostaFor" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/><br/>
                                </t>
                    </td>
                   
                    
                </tr>
                            <tr scope="row">
                      <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Totale Imponibile</span>
                    </th>
                         <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Totale IVA</span>
                    </th>
                         <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Abbuoni IVA Omaggi</span>
                    </th>
                             <th class="p-1 align-middle text-center smaller-font" style="width:12.5%">
                        <span>Totale Documento</span>
                    </th>
                </tr>
                
                <tr scope="row">
           
                      <td class="p-1 align-middle text-right smaller-font" style="width:12.5%">
                        <span t-field="o.amount_untaxed"/>
                        
                    </td>
                         <td class="p-1 align-middle text-right smaller-font" style="width:12.5%">
                       
                              <t t-if="o.amount_sp&gt;0">
                          <span t-field="o.amount_tax"/>
                        
                         <span t-field="o.amount_sp" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                       </t>
                      <t t-else="">
                                
                                    <span t-field="o.amount_tax"/>
                              
                            </t>
                    
                       
                    </td>
                         <td class="p-1 align-middle text-right small-font " style="width:12.5%">
                         <!-- Abbuoni IVA Omaggi -->
                    </td>
                         <td class="p-1 align-middle text-right smaller-font " style="width:12.5%">
                         <t t-set="totale_documento" t-value="o.amount_total+o.amount_sp"/>
                                <strong t-esc="totale_documento" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </td>
                   
                    
                </tr>
                
                
                <tr scope="row">
                    <th rowspan="2" colspan="3" class="p-1 align-middle text-center smaller-font" style="width:50%">
            <span>AVVISO IMPORTANTE: i Vs. dati anagrafici e la partita iva che appaiono sul presente documento saranno quelli che verranno utilizzati, salvo Vs. diversa precisazione, agli effetti dell' Art. 2 DPR 633/72.
Con questo avviso Ci consideriamo esonerati da qualsiasi responsabilità prevista dall' Art.41 DPR 633/72.</span>
                    </th>
                         <th class="p-1 align-middle text-center smaller-font" style="width:16.6%">
                        <span>Acconto</span>
                    </th>
                         <th rowspan="2" class="p-1 align-middle text-center smaller-font" style="width:16.6%">
                        <span>CONTRIBUTO CONAI ASSOLTO</span>
                    </th>
                             <th colspan="2" class="p-1 align-middle text-center smaller-font" style="width:16.6%">
                        <span>Importo da Pagare</span>
                    </th>
                </tr>
                
                     
                                <tr scope="row">
           
                 
                         <td class="p-1 align-middle text-right small-font" style="width:16.6%">
                        <!-- Acconto  -->
                    </td>
                      
                         <td colspan="2" class="p-1 align-middle text-right small-font " style="width:16.6%">
                                                <t t-set="totale_documento" t-value="o.amount_total+o.amount_sp"/>
                                <strong t-esc="totale_documento" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </td>
                   
                    
                </tr>
                
                
            
         </tbody>
        </table>


    </table>   
   
   </div>
   

<div class="footer text-center" style="font-size:12px;">
    Pagina
    <span class="page"/>
    di
    <span class="topage"/>
</div>
       
        </t>
    </template>
    
    <template id="report_original_vendor_bill">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <div class="article"  t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')"></div>
            </t>
        </t>
    </template>

    
    <template id="fattura_imm_e_diff_main_template_puleo">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="abc_fattura_imm_e_diff_puleo.fattura_imm_e_diff_template_puleo" t-lang="o.partner_id.lang"/>
                <t t-set="print_with_payments" t-value="True"/>
            </t>
        </t>
    </template>
    
    <!-- Creo il record fattura_imm_e_diff_print_report_puleo, il quale sarebbe il tasto che stampa la fattura da Stampa 
         dalla vista della Fattura Cliente. -->
    
    <record id="fattura_imm_e_diff_print_report_puleo" model="ir.actions.report">
        <field name="name">Fattura immediata/differita Puleo</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">abc_fattura_imm_e_diff_puleo.fattura_imm_e_diff_main_template_puleo</field>
        <field name="report_file">abc_fattura_imm_e_diff_puleo.fattura_imm_e_diff_main_template_puleo</field>
        <field name="print_report_name">"Fattura Puleo - %s" %(object.name)</field>
        <!--field name="binding_model_id" ref="account.report_invoice_with_payments" /-->
        <field name="binding_model_id" ref="account.model_account_move" />
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="abc_fattura_imm_e_diff_puleo.fattura_imm_e_diff_formato_carta_puleo"/>
    </record>
    
</odoo>
